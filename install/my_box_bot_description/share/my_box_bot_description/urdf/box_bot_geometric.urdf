<?xml version="1.0"?>
<robot name="box_bot">

  <material name="black">
    <color rgba="0 0 0 1"/>
  </material>

  <material name="blue">
    <color rgba="0 0 1 1"/>
  </material>

  <!--Chassi do carro-->
  <link name="body_link">

    <visual>
      <geometry>
            <box size="0.256 0.150 0.065"/>
      </geometry>
    </visual>


    <collision>
      <geometry>
        <box size="0.256 0.150 0.065"/>
      </geometry>
    </collision>

    <inertial>
      <mass value="0.5"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0008333333333333335" ixy="0" ixz="0" iyy="0.0008333333333333335" iyz="0" izz="0.0008333333333333335"/>
    </inertial>




  </link>



  <!--Roda direita traseira do carro-->
  <joint name="wheel1_joint" type="continuous">
    <parent link="body_link"/>
    <child link="wheel1_link"/>
    <origin xyz="-0.0575 -0.0665 -0.03"/>
    <axis xyz="0 0 0"/>
  </joint>

  <link name="wheel1_link">

    <visual>  
      <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
      <geometry>
          <cylinder length="0.025" radius="0.033"/>
      </geometry>
    </visual>

    <collision>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <geometry>
          <cylinder length="0.025" radius="0.033"/>
        </geometry>
    </collision>


    <inertial>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <mass value="0.05"/>
        <inertia ixx="1.531666666666667e-05" ixy="0" ixz="0" iyy="1.531666666666667e-05" iyz="0" izz="3.0625000000000006e-05"/>
    </inertial>


  </link>

  <!--Roda esquerda traseira do carro-->
  <joint name="wheel2_joint" type="continuous">
    <parent link="body_link"/>
    <child link="wheel2_link"/>
    <origin xyz="-0.0575 0.0665 -0.03"/>
    <axis xyz="0 0 0"/>
  </joint>

  <link name="wheel2_link">


    <visual>
      <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
      <geometry>
          <cylinder length="0.025" radius="0.033"/>
      </geometry>
    </visual>

    <collision>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <geometry>
          <cylinder length="0.025" radius="0.033"/>
        </geometry>
    </collision>


    <inertial>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <mass value="0.05"/>
        <inertia ixx="1.531666666666667e-05" ixy="0" ixz="0" iyy="1.531666666666667e-05" iyz="0" izz="3.0625000000000006e-05"/>
    </inertial>

  </link>

  <!--Roda esquerda dianteira do carro-->
  <joint name="wheel3_joint" type="continuous">
    <parent link="body_link"/>
    <child link="wheel3_link"/>
    <origin xyz="0.0575 0.0665 -0.03"/>
    <axis xyz="0 0 0"/>
  </joint>

  <link name="wheel3_link">

    <visual>
      <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
      <geometry>
          <cylinder length="0.025" radius="0.033"/>
      </geometry>
    </visual>

    <collision>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <geometry>
          <cylinder length="0.025" radius="0.033"/>
        </geometry>
    </collision>


    <inertial>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <mass value="0.05"/>
        <inertia ixx="1.531666666666667e-05" ixy="0" ixz="0" iyy="1.531666666666667e-05" iyz="0" izz="3.0625000000000006e-05"/>
    </inertial>

    

  </link>

<!--Roda direita dianteira do carro-->
  <joint name="wheel4_joint" type="continuous">
    <parent link="body_link"/>
    <child link="wheel4_link"/>
    <origin xyz="0.0575 -0.0665 -0.03"/>
    <axis xyz="0 0 0"/>
  </joint>

  <link name="wheel4_link">

    <visual>
      <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
      <geometry>
          <cylinder length="0.025" radius="0.033"/>
      </geometry>
    </visual>

    <collision>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <geometry>
          <cylinder length="0.025" radius="0.033"/>
        </geometry>
    </collision>


    <inertial>
        <origin rpy="1.5707 1.5707 0 " xyz="0 0 0"/>
        <mass value="0.05"/>
        <inertia ixx="1.531666666666667e-05" ixy="0" ixz="0" iyy="1.531666666666667e-05" iyz="0" izz="3.0625000000000006e-05"/>
    </inertial>


  </link>

  <!--Estrutura para base do LIDAR-->

  <!--Struct 1-->
  <joint name="struct1_joint" type="fixed">
    <parent link="body_link"/>
    <child link="struct1_link"/>
    <origin xyz="0.0 0.0 0.05"/>
    <axis xyz="0 0 0"/>
  </joint>
  <link name="struct1_link">
    <visual>
      <geometry>
          <box size="0.01 0.01 0.038"/>
      </geometry>
    </visual>


    <collision>
      <geometry>
        <box size="0.01 0.01 0.038"/>
      </geometry>
    </collision>


    <inertial>
      <mass value="0.5"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0008333333333333335" ixy="0" ixz="0" iyy="0.0008333333333333335" iyz="0" izz="0.0008333333333333335"/>
    </inertial>


  </link>

  <!--Struct 2-->
  <joint name="struct2_joint" type="fixed">
    <parent link="body_link"/>
    <child link="struct2_link"/>
    <origin xyz="-0.059 0.0115 0.05"/>
    <axis xyz="0 0 0"/>
  </joint>
  <link name="struct2_link">
    <visual>
      <geometry>
          <box size="0.01 0.01 0.038"/>
      </geometry>

    </visual>


    <collision>
      <geometry>
        <box size="0.01 0.01 0.038"/>
      </geometry>
    </collision>


    <inertial>
      <mass value="0.5"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0008333333333333335" ixy="0" ixz="0" iyy="0.0008333333333333335" iyz="0" izz="0.0008333333333333335"/>
    </inertial>


  </link>

  <!--Struct 3-->
  <joint name="struct3_joint" type="fixed">
    <parent link="body_link"/>
    <child link="struct3_link"/>
    <origin xyz="-0.059 -0.0115 0.05"/>
    <axis xyz="0 0 0"/>
  </joint>
  <link name="struct3_link">
    <visual>
      <geometry>
          <box size="0.01 0.01 0.038"/>
      </geometry>
    </visual>


    <collision>
      <geometry>
        <box size="0.01 0.01 0.038"/>
      </geometry>
    </collision>


    <inertial>
      <mass value="0.5"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0008333333333333335" ixy="0" ixz="0" iyy="0.0008333333333333335" iyz="0" izz="0.0008333333333333335"/>
    </inertial>


  </link>

  <!--Base do LIDAR-->
  <joint name="lidarB_joint" type="fixed">
    <parent link="struct1_link"/>
    <child link="lidarB_link"/>
    <origin xyz="-0.03 0.0 0.019"/>
    <axis xyz="0 0 0"/>
  </joint>
  <link name="lidarB_link">


    <visual>
      <geometry>
          <box size="0.08 0.08 0.005"/>
      </geometry>
    </visual>


    <collision>
      <geometry>
        <box size="0.08 0.08 0.005"/>
      </geometry>
    </collision>


    <inertial>
      <mass value="0.5"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0008333333333333335" ixy="0" ixz="0" iyy="0.0008333333333333335" iyz="0" izz="0.0008333333333333335"/>
    </inertial>
  </link>

  <!--LIDAR-->
  <joint name="lidar_joint" type="fixed">
    <parent link="lidarB_link"/>
    <child link="lidar_link"/>
    <origin xyz="0.0 0.0 0.013"/>
    <axis xyz="0 0 0"/>
  </joint>

  <link name="lidar_link">


    <visual>
      <geometry>
        <mesh filename="package://my_box_bot_description/meshes/sensors/rplidar.dae" scale="1.0 1.0 1.0"/>
      </geometry>
      <material name="black"/>
    </visual>


    <collision>
      <geometry>
        <box size="0.05 0.05 0.030"/>
      </geometry>
    </collision>
      
    
    <inertial>
      <mass value="0.5"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0008333333333333335" ixy="0" ixz="0" iyy="0.0008333333333333335" iyz="0" izz="0.0008333333333333335"/>
    </inertial>

  </link>

  <!---->
  <joint name="gyro_joint" type="fixed">
    <parent link="body_link"/>
    <child link="gyro_link"/>
    <origin xyz="-0.03 0.0 0.0325"/>
    <axis xyz="0 0 0"/>
  </joint>


  <link name="gyro_link">
    <visual>
      <geometry>
          <box size="0.02 0.02 0.015"/>
      </geometry>
      <material name="blue"/>
    </visual>


    <collision>
      <geometry>
        <box size="0.02 0.02 0.015"/>
      </geometry>
    </collision>
      


    <inertial>
      <mass value="0.5"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0008333333333333335" ixy="0" ixz="0" iyy="0.0008333333333333335" iyz="0" izz="0.0008333333333333335"/>
    </inertial>
  </link>


  <!--Plugins-->

  <gazebo reference="lidar_link">
    <sensor type="ray" name="head_hokuyo_sensor">
        <visualize>true</visualize>
        <update_rate>10</update_rate>
        <ray>
            <scan>
              <horizontal>
                <samples>920</samples>
                <resolution>1</resolution>
                <min_angle>-3.14</min_angle>
                <max_angle>3.14</max_angle>
              </horizontal>
            </scan>
            <range>
              <min>0.1</min>
              <max>40.0</max>
              <resolution>0.05</resolution>
            </range>
            <noise>
              <type>gaussian</type>
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </noise>
        </ray>

        <plugin name="gazebo_ros_head_hokuyo_controlle" filename="libgazebo_ros_ray_sensor.so" >
        <ros>
          <remapping>~/out:=/scan</remapping>                                                               
        </ros>
        <output_type>sensor_msgs/LaserScan</output_type>
        </plugin>
    </sensor>
  </gazebo>

    <gazebo>
      <plugin name="skid_steer_drive_controller" filename="libgazebo_ros_skid_steer_drive.so">
        <ros>
          <remapping>~/out:=/cmd_vel</remapping>                                                               
        </ros>
        <output_type>geometry_msgs/msg/Twist</output_type>
        <updateRate>100.0</updateRate>
        <robotNamespace>/</robotNamespace>
        <leftFrontJoint>wheel3_link</leftFrontJoint>
        <rightFrontJoint>wheel4_link</rightFrontJoint>
        <leftRearJoint>wheel2_link</leftRearJoint>
        <rightRearJoint>wheel1_link</rightRearJoint>
        <wheelSeparation>0.128</wheelSeparation>
        <wheelDiameter>0.66</wheelDiameter>
        <robotBaseFrame>base_link</robotBaseFrame>
        <torque>20</torque>
        <commandTopic>cmd_vel</commandTopic>
        <odometryTopic>odom</odometryTopic>
        <odometryFrame>odom</odometryFrame>
        <broadcastTF>true</broadcastTF>
      </plugin>
    </gazebo>

    <gazebo reference="gyro_link">
      <gravity>true</gravity>
      <sensor name="imu_sensor" type="imu">
        <always_on>true</always_on>
        <update_rate>100</update_rate>
        <visualize>true</visualize>
        <topic>imu</topic>
        <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
          <ros>
            <remapping>~/out:=/imu</remapping>                                                               
          </ros>
          <output_type>sensor_msgs/Imu</output_type>
          <bodyName>imu_link</bodyName>
          <updateRateHZ>10.0</updateRateHZ>
          <gaussianNoise>0.0</gaussianNoise>
          <xyzOffset>0 0 0</xyzOffset>
          <rpyOffset>0 0 0</rpyOffset>
          <frameName>imu_link</frameName>
          <initialOrientationAsReference>false</initialOrientationAsReference>
        </plugin>
        <pose>0 0 0 0 0 0</pose>
      </sensor>
    </gazebo>  


</robot>